- name: 'delete certificate if existing'
  delegate_to: localhost
  ignore_errors: yes
  citrix_adc_nitro_request:
    validate_certs: no
    nitro_user: '{{ nitro_user }}'
    nitro_pass: '{{ nitro_pass }}'
    nsip: '{{ nsip }}'
    operation: delete_by_args
    resource: systemfile/certificate1.crt
    args:
      filelocation: '%2Fvar%2Ftmp'

- name: 'delete key if existing'
  delegate_to: localhost
  ignore_errors: yes
  citrix_adc_nitro_request:
    validate_certs: no
    nitro_user: '{{ nitro_user }}'
    nitro_pass: '{{ nitro_pass }}'
    nsip: '{{ nsip }}'
    operation: delete_by_args
    resource: systemfile/key1.pem
    args:
      filelocation: '%2Fvar%2Ftmp'

- name: 'upload certificate'
  delegate_to: localhost
  citrix_adc_nitro_request:
    validate_certs: no
    nitro_user: '{{ nitro_user }}'
    nitro_pass: '{{ nitro_pass }}'
    nsip: '{{ nsip }}'
    operation: add
    resource: systemfile
    attributes:
      filename: certificate1.crt
      filecontent: "{{ lookup('file', './certificate1.crt') | b64encode }}"
      filelocation: /var/tmp

- name: 'upload key'
  delegate_to: localhost
  citrix_adc_nitro_request:
    validate_certs: no
    nitro_user: '{{ nitro_user }}'
    nitro_pass: '{{ nitro_pass }}'
    nsip: '{{ nsip }}'
    operation: add
    resource: systemfile
    attributes:
      filename: key1.pem
      filecontent: "{{ lookup('file', './key1.pem') | b64encode }}"
      filelocation: /var/tmp
